#!/bin/bash

# Using this tool: https://github.com/lagmoellertim/unsilence
# Install it as instructed there and adjuct path below if it's not in the PATH

# UNSILENCE_PATH="$HOME/.local/bin/unsilence"
UNSILENCE_PATH="unsilence"

{ {
    for f in "${@}"; do
        printf "%s: %s:\n" "$DATE" "$f"

        basename="$(basename -- "$f")"
        filename="${basename%.*}"
        extension="${basename##*.}"

        out="$filename.tmp.$extension"
        orig="$filename.original.$extension"
        prog="$filename.in-progress.$extension"
        i='1'
        while [ -f "$orig" ]; do
            orig="$filename.original$i.$extension"
            i=$((i + 1))
        done
        cp -n "$f" "$orig" &&
            mv "$f" "$prog" &&
            "$UNSILENCE_PATH" --non-interactive-mode --threads '2' --audio-only --silent-speed '8' --silence-level '-30' "$prog" "$out" &&
            mv "$out" "$f"
        rm "$prog"

        printf "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n"
    done
} 2>&1; } >>".unsilence.log"
